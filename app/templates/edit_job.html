{% extends "base.html" %}

{% block title %}Редактировать проект{% endblock %}

{% block content %}
<div class="max-w-2xl mx-auto card-lg p-6 mt-6">
    <h2 class="text-3xl font-bold mb-6">Редактировать проект</h2>
    
    <form method="post" class="space-y-4">
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Название проекта</label>
            <input type="text" name="title" value="{{ job.title }}" 
                   class="w-full p-2 border rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500" required>
        </div>
        
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Описание</label>
            <textarea name="description" rows="4" 
                      class="w-full p-2 border rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500" required>{{ job.description }}</textarea>
        </div>
        
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Дедлайн</label>
            <input type="date" name="deadline" id="deadline" value="{{ job.deadline }}"
                   class="w-full p-2 border rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500" required>
            <p class="text-sm text-gray-500 mt-1">Выберите дату дедлайна проекта</p>
            <div id="date-error" class="text-red-500 text-sm mt-1 hidden">Дата не может быть в прошлом</div>
        </div>
        
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Приоритет</label>
            <select name="priority" class="w-full p-2 border rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                <option value="low" {% if job.get('priority') == 'low' %}selected{% endif %}>Низкий</option>
                <option value="medium" {% if job.get('priority') == 'medium' %}selected{% endif %}>Средний</option>
                <option value="high" {% if job.get('priority') == 'high' %}selected{% endif %}>Высокий</option>
            </select>
        </div>
        
        <div class="flex space-x-3">
            <button type="submit" 
                    class="btn-primary">
                Сохранить изменения
            </button>
            <a href="/jobs/{{ job.id }}" 
               class="px-4 py-2 border rounded hover:bg-gray-50 transition">
                Отмена
            </a>
        </div>
    </form>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.querySelector('form');
    const deadlineInput = document.getElementById('deadline');
    const dateError = document.getElementById('date-error');
    const submitButton = form.querySelector('button[type="submit"]');
    
    // Устанавливаем минимальную дату (сегодня) и максимальную дату (2099 год)
    const today = new Date().toISOString().split('T')[0];
    const maxDateStr = '2099-12-31';
    
    deadlineInput.setAttribute('min', today);
    deadlineInput.setAttribute('max', maxDateStr);
    
    function validateDate() {
        const selectedDate = deadlineInput.value;
        const today = new Date().toISOString().split('T')[0];
        
        if (selectedDate && (selectedDate < today || selectedDate > maxDateStr)) {
            dateError.classList.remove('hidden');
            if (selectedDate < today) {
                dateError.textContent = 'Дата не может быть в прошлом';
            } else {
                dateError.textContent = 'Дата не может быть позже 2099 года';
            }
            submitButton.disabled = true;
            submitButton.classList.add('opacity-50', 'cursor-not-allowed');
            return false;
        } else {
            dateError.classList.add('hidden');
            submitButton.disabled = false;
            submitButton.classList.remove('opacity-50', 'cursor-not-allowed');
            return true;
        }
    }
    
    // Валидация при изменении даты
    deadlineInput.addEventListener('change', validateDate);
    
    // Валидация при отправке формы
    form.addEventListener('submit', function(e) {
        if (!validateDate()) {
            e.preventDefault();
            deadlineInput.focus();
        }
    });
    
    // Инициальная валидация
    validateDate();
});
</script>
{% endblock %}