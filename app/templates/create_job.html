{% extends "base.html" %}

{% block title %}Создать проект{% endblock %}

{% block content %}
<div class="max-w-2xl mx-auto bg-white p-4 sm:p-6 rounded-lg shadow mt-4 sm:mt-6">
    <h1 class="text-2xl sm:text-3xl font-bold mb-6 text-center">Создать проект</h1>
    {% if error %}
    <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-6">
        {{ error }}
    </div>
    {% endif %}
    
    <form method="post" enctype="multipart/form-data" class="space-y-4 sm:space-y-6">
        <div>
            <label class="block text-gray-700 mb-2 font-medium">Название проекта</label>
            <input name="title" placeholder="Заголовок" class="w-full border border-gray-300 p-3 sm:p-4 rounded-lg focus:ring-2 focus:ring-black focus:border-black transition-colors text-base" required>
        </div>
        
        <div>
            <label class="block text-gray-700 mb-2 font-medium">Описание</label>
            <textarea name="description" placeholder="Описание проекта" class="w-full border border-gray-300 p-3 sm:p-4 rounded-lg focus:ring-2 focus:ring-black focus:border-black transition-colors text-base" rows="4" required></textarea>
        </div>
        
        <div>
            <label class="block text-gray-700 mb-2 font-medium">Дедлайн</label>
            <input type="date" name="deadline" id="deadline" class="w-full border border-gray-300 p-3 sm:p-4 rounded-lg focus:ring-2 focus:ring-black focus:border-black transition-colors text-base" required>
            <p class="text-sm text-gray-500 mt-1">Выберите дату дедлайна проекта</p>
            <div id="date-error" class="text-red-500 text-sm mt-1 hidden">Дата не может быть в прошлом</div>
        </div>
        
        <div>
            <label class="block text-gray-700 mb-2 font-medium">Приоритет</label>
            <select name="priority" class="w-full border border-gray-300 p-3 sm:p-4 rounded-lg focus:ring-2 focus:ring-black focus:border-black transition-colors text-base">
                <option value="low">Низкий</option>
                <option value="medium" selected>Средний</option>
                <option value="high">Высокий</option>
            </select>
        </div>
        
        <div>
            <label class="block text-gray-700 mb-2 font-medium">Файлы проекта (необязательно)</label>
            <input type="file" name="files" multiple accept=".pdf,.doc,.docx,.txt,.jpg,.jpeg,.png" 
                   class="w-full border border-gray-300 p-3 sm:p-4 rounded-lg focus:ring-2 focus:ring-black focus:border-black transition-colors text-base">
            <p class="text-sm text-gray-500 mt-1">Можно загрузить несколько файлов. Максимум 10MB на файл.</p>
        </div>
        
        <div class="flex flex-col sm:flex-row gap-3 sm:gap-4 pt-4">
            <button type="submit" class="w-full sm:w-auto bg-black text-white px-6 py-3 sm:py-4 rounded-lg hover:bg-gray-800 transition-all duration-200 font-medium text-base">
                Создать проект
            </button>
            <a href="/" class="w-full sm:w-auto bg-gray-100 text-gray-800 px-6 py-3 sm:py-4 rounded-lg hover:bg-gray-200 transition-all duration-200 font-medium text-base text-center">
                Отмена
            </a>
        </div>
    </form>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.querySelector('form');
    const deadlineInput = document.getElementById('deadline');
    const dateError = document.getElementById('date-error');
    const submitButton = form.querySelector('button[type="submit"]');
    
    // Устанавливаем минимальную дату (сегодня) и максимальную дату (2099 год)
    const today = new Date().toISOString().split('T')[0];
    const maxDateStr = '2099-12-31';
    
    deadlineInput.setAttribute('min', today);
    deadlineInput.setAttribute('max', maxDateStr);
    
    function validateDate() {
        const selectedDate = deadlineInput.value;
        const today = new Date().toISOString().split('T')[0];
        
        if (selectedDate && (selectedDate < today || selectedDate > maxDateStr)) {
            dateError.classList.remove('hidden');
            if (selectedDate < today) {
                dateError.textContent = 'Дата не может быть в прошлом';
            } else {
                dateError.textContent = 'Дата не может быть позже 2099 года';
            }
            submitButton.disabled = true;
            submitButton.classList.add('opacity-50', 'cursor-not-allowed');
            return false;
        } else {
            dateError.classList.add('hidden');
            submitButton.disabled = false;
            submitButton.classList.remove('opacity-50', 'cursor-not-allowed');
            return true;
        }
    }
    
    // Валидация при изменении даты
    deadlineInput.addEventListener('change', validateDate);
    
    // Валидация при отправке формы
    form.addEventListener('submit', function(e) {
        if (!validateDate()) {
            e.preventDefault();
            deadlineInput.focus();
        }
    });
    
    // Инициальная валидация
    validateDate();
});
</script>
{% endblock %}
